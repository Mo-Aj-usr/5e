<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>QCM - Empire carolingien (5e)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #2f6fdd;
      --primary-dark: #224f9e;
      --bg: #f5f7fb;
      --text: #222;
      --card-bg: #ffffff;
      --accent: #f0b429;
      --danger: #e04848;
      --success: #2e8b57;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--primary);
      color: #fff;
      padding: 1rem 1.5rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    header h1 {
      margin: 0;
      font-size: 1.25rem;
    }

    .dashboard {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .dash-item {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      white-space: nowrap;
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #fff;
      opacity: 0.8;
    }

    .main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 1rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
      padding: 1.5rem;
      max-width: 800px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .progress-bar-track {
      position: relative;
      width: 100%;
      height: 10px;
      background: #e1e5f0;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transition: width 0.3s ease;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #555;
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .question-number {
      font-weight: 600;
      color: var(--primary-dark);
    }

    .question-text {
      font-size: 1.05rem;
      margin-top: 0.25rem;
    }

    .answers {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .answer-option {
      border-radius: 10px;
      border: 1px solid #d1d5e4;
      padding: 0.55rem 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, transform 0.05s ease;
      background: #fafbff;
    }

    .answer-option:hover {
      background: #eef3ff;
      border-color: var(--primary);
      transform: translateY(-1px);
    }

    .answer-option input {
      accent-color: var(--primary);
    }

    .answer-option.correct {
      border-color: var(--success);
      background: #f0faf4;
    }

    .answer-option.incorrect {
      border-color: var(--danger);
      background: #fdeeee;
    }

    .answer-label {
      font-size: 0.95rem;
    }

    .feedback {
      border-radius: 10px;
      padding: 0.75rem 0.9rem;
      font-size: 0.9rem;
      line-height: 1.4;
      display: none;
    }

    .feedback.visible {
      display: block;
    }

    .feedback.correct {
      background: #f0faf4;
      border: 1px solid var(--success);
      color: var(--success);
    }

    .feedback.incorrect {
      background: #fdeeee;
      border: 1px solid var(--danger);
      color: var(--danger);
    }

    .feedback strong {
      display: block;
      margin-bottom: 0.25rem;
    }

    .footer {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.75rem;
    }

    .nav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1.1rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 10px rgba(47,111,221,0.4);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: #e4e7f3;
      color: #27314d;
    }

    .btn-secondary:hover {
      background: #d3d7eb;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid #d1d5e4;
      color: #333;
    }

    .btn-ghost:hover {
      background: #f2f4fb;
    }

    .summary {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #555;
    }

    .badge {
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eef3ff;
      color: var(--primary-dark);
    }

    @media (max-width: 600px) {
      header {
        align-items: flex-start;
      }
      .card {
        padding: 1rem;
      }
      .question-text {
        font-size: 1rem;
      }
      .nav-buttons {
        width: 100%;
        justify-content: space-between;
      }
      button {
        flex: 1 1 calc(33% - 0.5rem);
        justify-content: center;
      }
      .btn-ghost {
        flex-basis: 100%;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>QCM Histoire 5e – L'Empire carolingien</h1>
    <div class="dashboard">
      <div class="dash-item">
        <span class="dot"></span>
        <span id="dash-question">Question 1 / 10</span>
      </div>
      <div class="dash-item">
        <span class="dot"></span>
        <span id="dash-score">Score : 0 / 10</span>
      </div>
      <div class="dash-item">
        <span class="dot"></span>
        <span id="dash-status">En cours…</span>
      </div>
    </div>
  </header>

  <main class="main">
    <section class="card" aria-live="polite">
      <div>
        <div class="progress-label">
          <span>Progression</span>
          <span id="progress-percent">0 %</span>
        </div>
        <div class="progress-bar-track">
          <div class="progress-bar-fill" id="progress-bar"></div>
        </div>
      </div>

      <div class="question-header">
        <div>
          <div class="question-number" id="question-number">Question 1</div>
          <div class="question-text" id="question-text"></div>
        </div>
        <div class="badge" id="badge-theme">Empire carolingien</div>
      </div>

      <form id="answers-form" class="answers">
        <!-- options injectées en JS -->
      </form>

      <div id="feedback" class="feedback">
        <!-- feedback injecté en JS -->
      </div>

      <div class="footer">
        <button id="validate-btn" class="btn-ghost" type="button">
          Valider la question
        </button>
        <div class="nav-buttons">
          <button id="prev-btn" class="btn-secondary" type="button">
            ← Précédent
          </button>
          <button id="next-btn" class="btn-secondary" type="button">
            Suivant →
          </button>
          <button id="finish-btn" class="btn-primary" type="button">
            Terminer
          </button>
        </div>
      </div>

      <div class="summary" id="summary-text">
        Réponds à chaque question et clique sur « Valider la question » pour voir la correction détaillée.
      </div>
    </section>
  </main>
</div>

<script>
  const questions = [
    {
      theme: "Fondation de l'empire",
      question: "En quelle année Charlemagne est-il sacré empereur, marquant la naissance officielle de l’Empire carolingien ?",
      options: [
        "En 732, après la bataille de Poitiers",
        "En 800, le jour de Noël à Rome",
        "En 843, lors du traité de Verdun",
        "En 476, à la chute de l’Empire romain d’Occident"
      ],
      correctIndex: 1,
      explanation:
        "Charlemagne est couronné empereur par le pape Léon III à Rome, le 25 décembre 800. Ce sacre fonde l’Empire carolingien en Occident et fait de Charlemagne l’héritier des empereurs romains.",
    },
    {
      theme: "Territoires",
      question: "Sur quelle grande région de l’Europe l’Empire carolingien s’étend-il principalement à l’époque de Charlemagne ?",
      options: [
        "L’Europe occidentale, de l’Elbe à l’Èbre",
        "L’Europe orientale, autour de Constantinople",
        "L’Afrique du Nord et le Proche-Orient",
        "La Scandinavie et la Russie"
      ],
      correctIndex: 0,
      explanation:
        "L’Empire carolingien couvre une grande partie de l’Europe occidentale, notamment la France, l’Allemagne, le nord de l’Italie et une partie de l’Espagne, entre les fleuves Elbe et Èbre.",
    },
    {
      theme: "Capitale",
      question: "Quelle est la capitale politique de l’Empire carolingien sous Charlemagne ?",
      options: [
        "Rome",
        "Paris",
        "Aix-la-Chapelle",
        "Constantinople"
      ],
      correctIndex: 2,
      explanation:
        "Charlemagne installe sa capitale à Aix-la-Chapelle (actuelle Allemagne). La ville devient le centre politique et religieux de l’Empire carolingien.",
    },
    {
      theme: "Empire chrétien",
      question: "Pourquoi dit-on que l’Empire carolingien est un empire chrétien ?",
      options: [
        "Parce que l’empereur se déclare chef de toutes les religions",
        "Parce que le pape interdit toute autre religion",
        "Parce que Charlemagne et ses successeurs imposent et diffusent le christianisme dans les territoires conquis",
        "Parce que la capitale se situe à Rome"
      ],
      correctIndex: 2,
      explanation:
        "Charlemagne et son fils Louis le Pieux imposent la religion chrétienne dans les régions conquises et soutiennent l’Église. L’Empire carolingien se présente comme le défenseur de la chrétienté.",
    },
    {
      theme: "Organisation du pouvoir",
      question: "Comment Charlemagne administre-t-il son vaste empire ?",
      options: [
        "Uniquement en se déplaçant en permanence dans tout l’empire",
        "Grâce à des comtes et des évêques qu’il nomme pour gouverner les comtés",
        "En laissant les villes se gouverner sans contrôle",
        "En confiant tout le pouvoir au pape"
      ],
      correctIndex: 1,
      explanation:
        "Charlemagne s’appuie sur des comtes pour diriger les comtés et sur des évêques pour encadrer l’Église. Ils appliquent ses décisions dans les différentes régions de l’empire.",
    },
    {
      theme: "Missi dominici",
      question: "Qui sont les « missi dominici » dans l’Empire carolingien ?",
      options: [
        "Des soldats chargés de défendre les frontières",
        "Des marchands qui ravitaillent la cour de Charlemagne",
        "Des envoyés de l’empereur chargés de contrôler les comtes et l’application de ses ordres",
        "Des moines chargés de copier les manuscrits"
      ],
      correctIndex: 2,
      explanation:
        "Les missi dominici sont des « envoyés du maître » qui parcourent le royaume pour vérifier que les comtes obéissent bien aux ordres de Charlemagne et que la justice est rendue correctement.",
    },
    {
      theme: "Renouveau culturel",
      question: "Pourquoi parle-t-on de « renouveau carolingien » à l’époque de Charlemagne ?",
      options: [
        "Parce que les guerres cessent définitivement en Europe",
        "Parce que Charlemagne développe l’enseignement, les écoles et le travail des copistes dans les monastères",
        "Parce que toutes les villes se couvrent de gratte-ciel",
        "Parce que le commerce avec l’Asie disparaît"
      ],
      correctIndex: 1,
      explanation:
        "Charlemagne favorise l’ouverture d’écoles dans les monastères, encourage la copie des textes anciens et l’étude du latin. Cela entraîne un renouveau culturel et intellectuel dans l’Empire.",
    },
    {
      theme: "Écriture et langue",
      question: "Quelle est la langue officielle de l’Empire carolingien et quelle nouveauté dans l’écriture se développe ?",
      options: [
        "Le grec et l’alphabet cyrillique",
        "Le latin et une nouvelle écriture plus lisible, la minuscule caroline",
        "L’arabe et la calligraphie coufique",
        "Le français et l’imprimerie"
      ],
      correctIndex: 1,
      explanation:
        "Le latin est la langue officielle de l’Empire carolingien. Les lettrés mettent au point la minuscule caroline, une écriture plus régulière et lisible, qui facilite la copie des manuscrits.",
    },
    {
      theme: "Partage de l'empire",
      question: "Quel traité, en 843, partage l’Empire carolingien entre les petits-fils de Charlemagne ?",
      options: [
        "Le traité de Verdun",
        "Le traité de Rome",
        "Le traité de Francfort",
        "Le traité de Poitiers"
      ],
      correctIndex: 0,
      explanation:
        "En 843, le traité de Verdun partage l’Empire carolingien entre les trois petits-fils de Charlemagne. Ce partage marque le début de l’éclatement de l’empire en plusieurs royaumes.",
    },
    {
      theme: "Menaces extérieures",
      question: "Quelle est l’une des causes de l’affaiblissement et de la fin de l’Empire carolingien au IXe siècle ?",
      options: [
        "Les conquêtes réussies en Afrique",
        "La découverte de l’Amérique",
        "Les invasions de Vikings, Sarrasins et Hongrois qui attaquent l’empire",
        "L’interdiction du commerce par le pape"
      ],
      correctIndex: 2,
      explanation:
        "Au IXe siècle, l’Empire carolingien subit de nombreuses attaques : Vikings venant du nord, Sarrasins du sud et Hongrois de l’est. Ces invasions affaiblissent le pouvoir impérial et accélèrent la fin de l’empire.",
    }
  ];

  let currentIndex = 0;
  let score = 0;
  const totalQuestions = questions.length;
  const answered = new Array(totalQuestions).fill(false);
  const userAnswers = new Array(totalQuestions).fill(null);

  const dashQuestion = document.getElementById("dash-question");
  const dashScore = document.getElementById("dash-score");
  const dashStatus = document.getElementById("dash-status");
  const questionNumber = document.getElementById("question-number");
  const questionText = document.getElementById("question-text");
  const badgeTheme = document.getElementById("badge-theme");
  const answersForm = document.getElementById("answers-form");
  const feedbackEl = document.getElementById("feedback");
  const validateBtn = document.getElementById("validate-btn");
  const prevBtn = document.getElementById("prev-btn");
  const nextBtn = document.getElementById("next-btn");
  const finishBtn = document.getElementById("finish-btn");
  const progressBar = document.getElementById("progress-bar");
  const progressPercent = document.getElementById("progress-percent");
  const summaryText = document.getElementById("summary-text");

  function renderQuestion(index) {
    const q = questions[index];

    questionNumber.textContent = `Question ${index + 1}`;
    questionText.textContent = q.question;
    badgeTheme.textContent = q.theme;

    dashQuestion.textContent = `Question ${index + 1} / ${totalQuestions}`;
    dashScore.textContent = `Score : ${score} / ${totalQuestions}`;
    dashStatus.textContent = `En cours…`;

    const progress = Math.round(((index) / totalQuestions) * 100);
    progressBar.style.width = `${progress}%`;
    progressPercent.textContent = `${progress} %`;

    answersForm.innerHTML = "";
    q.options.forEach((opt, i) => {
      const id = `q${index}_opt${i}`;
      const wrapper = document.createElement("label");
      wrapper.className = "answer-option";
      wrapper.setAttribute("for", id);

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "answer";
      input.value = i;
      input.id = id;

      if (userAnswers[index] === i) {
        input.checked = true;
      }

      const span = document.createElement("span");
      span.className = "answer-label";
      span.textContent = opt;

      wrapper.appendChild(input);
      wrapper.appendChild(span);
      answersForm.appendChild(wrapper);
    });

    feedbackEl.className = "feedback";
    feedbackEl.textContent = "";

    if (answered[index]) {
      showCorrection(index, false);
    }
  }

  function showCorrection(index, updateScore = true) {
    const q = questions[index];
    const selectedValue = userAnswers[index];

    if (selectedValue === null) {
      feedbackEl.className = "feedback incorrect visible";
      feedbackEl.innerHTML =
        "<strong>Pas de réponse enregistrée.</strong> Choisis une option puis clique sur « Valider la question » pour voir la correction.";
      return;
    }

    const optionsNodes = answersForm.querySelectorAll(".answer-option");
    optionsNodes.forEach((node, i) => {
      node.classList.remove("correct", "incorrect");
      if (i === q.correctIndex) {
        node.classList.add("correct");
      }
      if (i === selectedValue && selectedValue !== q.correctIndex) {
        node.classList.add("incorrect");
      }
    });

    const isCorrect = selectedValue === q.correctIndex;

    if (updateScore && !answered[index]) {
      if (isCorrect) score++;
      answered[index] = true;
    }

    feedbackEl.className = "feedback visible " + (isCorrect ? "correct" : "incorrect");
    feedbackEl.innerHTML =
      "<strong>" +
      (isCorrect ? "Bonne réponse !" : "Mauvaise réponse.") +
      "</strong>" +
      q.explanation;

    dashScore.textContent = `Score : ${score} / ${totalQuestions}`;
  }

  validateBtn.addEventListener("click", () => {
    const checked = answersForm.querySelector("input[name='answer']:checked");
    if (!checked) {
      feedbackEl.className = "feedback incorrect visible";
      feedbackEl.innerHTML =
        "<strong>Aucune réponse sélectionnée.</strong> Choisis une proposition avant de valider.";
      return;
    }

    userAnswers[currentIndex] = Number(checked.value);
    showCorrection(currentIndex, true);
  });

  prevBtn.addEventListener("click", () => {
    currentIndex = (currentIndex - 1 + totalQuestions) % totalQuestions;
    renderQuestion(currentIndex);
  });

  nextBtn.addEventListener("click", () => {
    currentIndex = (currentIndex + 1) % totalQuestions;
    renderQuestion(currentIndex);
  });

  finishBtn.addEventListener("click", () => {
    const answeredCount = answered.filter(Boolean).length;
    const percent = Math.round((score / totalQuestions) * 100);
    dashStatus.textContent = "QCM terminé";
    progressBar.style.width = "100%";
    progressPercent.textContent = "100 %";

    summaryText.textContent =
      `QCM terminé : ${answeredCount} question(s) corrigée(s) sur ${totalQuestions}, score ${score}/${totalQuestions} (soit ${percent} %). ` +
      `Tu peux encore naviguer avec « Précédent » et « Suivant » pour revoir les corrections.`;
  });

  renderQuestion(currentIndex);
</script>
</body>
</html>

